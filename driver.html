<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Driver</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="./config.js"></script>
</head>
<body class="bg-sky-50 min-h-screen">
  <div class="p-4 max-w-3xl mx-auto">
    <header class="flex items-center justify-between mb-4">
      <h1 class="text-lg font-semibold text-sky-600">Driver</h1>
      <a href="dashboard.html" class="text-sm">Kembali</a>
    </header>

    <div class="bg-white p-4 rounded shadow mb-4">
      <form id="form" class="grid gap-2">
        <input id="nama" class="border rounded px-3 py-2" placeholder="Nama driver" required>
        <input id="hp" class="border rounded px-3 py-2" placeholder="No HP" required>
        <div class="flex gap-2">
          <button class="py-2 px-4 bg-sky-500 text-white rounded">Tambah</button>
          <button type="button" id="refresh" class="py-2 px-4 border rounded">Refresh</button>
        </div>
      </form>
      <div id="spinner" class="hidden mt-3"><div class="w-8 h-8 border-4 rounded-full spinner animate-spin border-sky-500 border-t-transparent"></div></div>
      <div id="list" class="mt-3 grid gap-2"></div>
    </div>
  </div>

<script>
const api = API_URL;
const token = localStorage.getItem('iarmada_token');
const id_pt = localStorage.getItem('iarmada_id_pt');
if (!token) window.location.href='login.html';

async function loadList(){
  document.getElementById('spinner').classList.remove('hidden');
  const res = await fetch(api + '?action=getDrivers&id_pt='+encodeURIComponent(id_pt));
  const j = await res.json();
  const out = document.getElementById('list'); out.innerHTML='';
  if (j.ok) {
    j.data.forEach(d=>{
      const el = document.createElement('div');
      el.className='p-2 border rounded bg-white flex justify-between items-center';
      el.innerHTML = `<div><div class="font-medium">${d.nama}</div><div class="text-sm text-slate-500">${d.no_hp}</div></div><div><button class="del text-sm text-red-600" data-id="${d.id_driver}">Hapus</button></div>`;
      out.appendChild(el);
    });
  } else out.textContent='Gagal load';
  document.getElementById('spinner').classList.add('hidden');
}

document.getElementById('form').addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  const nama = document.getElementById('nama').value.trim();
  const no_hp = document.getElementById('hp').value.trim();
  const res = await fetch(api, {method:'POST', body: JSON.stringify({action:'addDriver', token, nama, no_hp})});
  const j = await res.json();
  if (!j.ok) alert(j.error||'Gagal'); else {
    document.getElementById('nama').value=''; document.getElementById('hp').value='';
    loadList();
  }
});

document.getElementById('list').addEventListener('click', (ev)=>{
  if (ev.target.classList.contains('del')) {
    alert('Untuk sementara hapus belum diimplementasi di UI. Anda dapat hapus dari spreadsheet langsung.');
  }
});

document.getElementById('refresh').addEventListener('click', loadList);
loadList();
</script>
</body>
</html>
